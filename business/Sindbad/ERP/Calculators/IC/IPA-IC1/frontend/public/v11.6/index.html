<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>IPA Calculator — Ivory Coast (UI v11.6)</title>
  <!-- Tailwind CDN only for dev speed -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* no floating/sticky trays; full document scroll */
    .no-float, .no-float * { position: static !important; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-7xl mx-auto p-4 space-y-4 no-float">
    <!-- Header -->
    <div class="flex items-center justify-between">
      <h1 class="text-xl font-semibold">IPA Calculator — Ivory Coast</h1>
      <div class="flex items-center gap-2">
        <span class="rounded-full bg-gray-100 text-gray-700 text-xs px-2 py-1">UI v11.6</span>
        <button id="btnCompute" class="rounded-xl bg-black text-white px-3 py-2 text-sm">Compute (preview)</button>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <!-- Left / Inputs -->
      <div class="lg:col-span-2 space-y-4">
        <!-- Scenario Details (trimmed) -->
        <div class="rounded-2xl border border-gray-200 bg-white shadow-sm">
          <div class="px-4 pt-4">
            <div class="text-sm font-semibold">Scenario Details</div>
          </div>
          <div class="px-4 pb-4 grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
            <div><label class="text-gray-600 text-xs">Calc Version</label><input class="w-full mt-1 rounded-lg border border-gray-300 px-2 py-1.5" value="1.0.0" /></div>
            <div><label class="text-gray-600 text-xs">Client name</label><input class="w-full mt-1 rounded-lg border border-gray-300 px-2 py-1.5" placeholder="Enter client"/></div>
            <div><label class="text-gray-600 text-xs">Operator (user)</label><input class="w-full mt-1 rounded-lg border border-gray-300 px-2 py-1.5" placeholder="e.g. A. Traoré"/></div>
          </div>
        </div>

        <!-- Asset & Contract Parameters (trimmed) -->
        <div class="rounded-2xl border border-gray-200 bg-white shadow-sm">
          <div class="px-4 pt-4"><div class="text-sm font-semibold">Asset & Contract Parameters</div></div>
          <div class="px-4 pb-4 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
            <div><label class="text-gray-600 text-xs">Asset Value (gross)</label><input id="gross" class="w-full mt-1 rounded-lg border border-gray-300 px-2 py-1.5" value="0"/></div>
            <div><label class="text-gray-600 text-xs">VAT Rate (%)</label><input id="vatRate" class="w-full mt-1 rounded-lg border border-gray-300 px-2 py-1.5" value="18.00"/></div>
            <div><label class="text-gray-600 text-xs">Asset Value (net)</label><input id="net" class="w-full mt-1 rounded-lg border border-gray-300 px-2 py-1.5" placeholder="Computed = Gross / (1 + VAT%)" disabled/></div>
            <div><label class="text-gray-600 text-xs">VAT Amount</label><input id="vatAmt" class="w-full mt-1 rounded-lg border border-gray-300 px-2 py-1.5" placeholder="Computed = Gross − Net" disabled/></div>
          </div>
        </div>

        <!-- Taxes & Fees (TSF) -->
        <div class="rounded-2xl border border-gray-200 bg-white shadow-sm">
          <div class="px-4 pt-4 flex items-center justify-between">
            <div class="text-sm font-semibold">Taxes & Fees (TSF)</div>
            <label class="inline-flex items-center gap-2 text-sm">
              <input id="teeToggle" type="checkbox" class="h-4 w-4 accent-black" />
              <span>TEE Applicable</span>
            </label>
          </div>
          <div class="px-4 pb-4 text-sm text-gray-600">
            <ul class="list-disc ml-5 space-y-1">
              <li>TSE (F): percent_of_d</li>
              <li>Loan Registration (M): percent_of_(b + f) with b = g</li>
              <li>Pledge Fees (G/H/I/J): fixed_amount</li>
              <li>Court Pledge (K): percent × multiplier of e</li>
              <li>TEE (L): percent_of_e (toggle)</li>
              <li>IRC (N): percent_of_c (funding interest)</li>
              <li>Banking Fee (O): percent_of_(b + c) with b = g</li>
            </ul>
          </div>
        </div>

        <!-- Insurance (P) — TEE is not mentioned here; default OFF -->
        <div class="rounded-2xl border border-gray-200 bg-white shadow-sm">
          <div class="px-4 pt-4"><div class="text-sm font-semibold">Insurance (P)</div></div>
          <div class="px-4 pb-4 text-sm space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div>
                <label class="text-gray-600 text-xs">P — Motor Insurance Y1 (capitalized)</label>
                <input id="insY1" class="w-full mt-1 rounded-lg border border-gray-300 px-2 py-1.5" placeholder="e.g. 300,000"/>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div>
                <label class="text-gray-600 text-xs">Motor Insurance Y2 (non-capitalized)</label>
                <input id="insY2" class="w-full mt-1 rounded-lg border border-gray-300 px-2 py-1.5" value="0"/>
              </div>
              <div>
                <label class="text-gray-600 text-xs">Month from start (Y2)</label>
                <input id="insY2Month" class="w-full mt-1 rounded-lg border border-gray-300 px-2 py-1.5" value="11"/>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div>
                <label class="text-gray-600 text-xs">Motor Insurance Y3 (non-capitalized)</label>
                <input id="insY3" class="w-full mt-1 rounded-lg border border-gray-300 px-2 py-1.5" value="0"/>
              </div>
              <div>
                <label class="text-gray-600 text-xs">Month from start (Y3)</label>
                <input id="insY3Month" class="w-full mt-1 rounded-lg border border-gray-300 px-2 py-1.5" value="23"/>
              </div>
            </div>
            <div class="pt-2">
              <button id="btnCompute2" class="rounded-xl bg-black text-white px-3 py-2 text-sm">Compute (preview)</button>
              <span class="text-xs text-gray-500 ml-2">TEE defaults to <strong>off</strong>. Y2/Y3 posted for preview only.</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right / Output Preview -->
      <div class="lg:col-span-1">
        <div class="rounded-2xl border border-gray-200 bg-white shadow-sm flex flex-col" style="min-height: 600px;">
          <div class="px-4 pt-4">
            <div class="text-sm font-semibold">Output Preview</div>
          </div>
          <div class="px-4 pb-4 text-sm text-gray-600 grow overflow-visible">
            <div class="text-xs text-gray-500 mb-3">Run Compute (preview) to refresh.</div>
            <div class="font-semibold text-gray-800 mb-2">Credit Facility (g) — preview</div>
            <div class="rounded-xl border border-gray-200">
              <div class="grid grid-cols-4 text-gray-500 text-xs font-semibold px-3 py-2">
                <div>Code</div><div>Basis</div><div>Value</div><div>Status</div>
              </div>
              <div id="previewRows" class="divide-y"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Basement outputs -->
    <div class="rounded-2xl border border-gray-200 bg-white shadow-sm">
      <div class="px-4 pt-4"><div class="text-sm font-semibold">Payment Schedule</div></div>
      <div class="px-4 pb-4 overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="text-gray-600">
            <tr class="text-left"><th class="py-2 pr-4">Period</th><th class="py-2 pr-4">Payment</th><th class="py-2 pr-4">Interest</th><th class="py-2 pr-4">Principal</th><th class="py-2">Balance</th></tr>
          </thead>
          <tbody id="tblPayment"></tbody>
        </table>
      </div>
    </div>

    <div class="rounded-2xl border border-gray-200 bg-white shadow-sm">
      <div class="px-4 pt-4"><div class="text-sm font-semibold">VAT Reports</div></div>
      <div class="px-4 pb-4 overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="text-gray-600">
            <tr class="text-left"><th class="py-2 pr-4">Period</th><th class="py-2 pr-4">VAT Base</th><th class="py-2">VAT</th></tr>
          </thead>
          <tbody id="tblVAT"></tbody>
        </table>
      </div>
    </div>

    <div class="rounded-2xl border border-gray-200 bg-white shadow-sm">
      <div class="px-4 pt-4"><div class="text-sm font-semibold">Capital Amortization</div></div>
      <div class="px-4 pb-4 overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="text-gray-600">
            <tr class="text-left"><th class="py-2 pr-4">Period</th><th class="py-2 pr-4">Principal</th><th class="py-2">Balance</th></tr>
          </thead>
          <tbody id="tblAmort"></tbody>
        </table>
      </div>
    </div>

    <div class="rounded-2xl border border-gray-200 bg-white shadow-sm">
      <div class="px-4 pt-4"><div class="text-sm font-semibold">TSF Recovery</div></div>
      <div class="px-4 pb-4 overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="text-gray-600">
            <tr class="text-left"><th class="py-2 pr-4">Period</th><th class="py-2 pr-4">Item</th><th class="py-2">Amount</th></tr>
          </thead>
          <tbody id="tblTSF"></tbody>
        </table>
      </div>
    </div>

    <div class="rounded-2xl border border-gray-200 bg-white shadow-sm">
      <div class="px-4 pt-4"><div class="text-sm font-semibold">Final Reconciliation</div></div>
      <div class="px-4 pb-4 overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="text-gray-600">
            <tr class="text-left"><th class="py-2 pr-4">Code</th><th class="py-2 pr-4">Basis</th><th class="py-2">Value</th></tr>
          </thead>
          <tbody id="tblFinal"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // TEE default OFF
    document.getElementById('teeToggle').checked = false;

    // Demo-only: compute net/VAT locally just to prove interactivity
    function recomputeLocal() {
      const gross = parseFloat(document.getElementById('gross').value || '0');
      const vatRate = parseFloat(document.getElementById('vatRate').value || '0') / 100.0;
      const net = vatRate >= 0 ? (gross / (1 + vatRate)) : 0;
      const vat = gross - net;
      document.getElementById('net').value = isFinite(net) ? net.toFixed(2) : '';
      document.getElementById('vatAmt').value = isFinite(vat) ? vat.toFixed(2) : '';
    }
    ['gross','vatRate'].forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener('input', recomputeLocal);
    });

    function fakePreviewRow(code,basis,value,status){
      return `<div class="grid grid-cols-4 px-3 py-2 text-sm"><div>${code}</div><div>${basis}</div><div>${value}</div><div>${status}</div></div>`;
    }
    function runPreview() {
      const tee = document.getElementById('teeToggle').checked ? 'on' : 'off';
      const rows = [
        fakePreviewRow('g','asset gross','—','ok'),
        fakePreviewRow('L (TEE)', 'percent_of_e', tee==='on'?'calc':'n/a', tee==='on'?'pending':'disabled')
      ].join('');
      document.getElementById('previewRows').innerHTML = rows;
    }
    document.getElementById('btnCompute').addEventListener('click', runPreview);
    document.getElementById('btnCompute2').addEventListener('click', runPreview);
  </script>
</body>
</html>
